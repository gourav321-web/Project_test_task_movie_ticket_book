c
@user
n
@user
@booking
n
booking
c
UserMailer.booking_confirmation(self).deliver_later
self
c
SendShowReminderJob.set(wait_until: reminder_time).perform_later(@booking.id)
reminder_time
reminder_time > Time.current
if reminder_time > Time.current
c
Time.current < (show.show_time - 2.hours)
Time.current
c
Time.current < (show.show_time - 2.hours)
Time.current
c
Time.current
c
total_available_seats
total_available_seats = selected_length + show.available_seats
selected_length + show.available_seats
c
total_available_seats
n
total_available_seats
n
total_available_seats
n
total_available_seats
show.update!(available_seats: total_available_seats)
selected_length + show.available_seats
show
booking
c
n
show
c
show
c
@show
n
booking
c
cc
c
Booking.create!(user: user,show: show,seat_numbers: "A1",status: "book")
c
Booking.create!(user: user,show: show,seat_numbers: "A1",status: "book")
c
Booking.create!(user: user,show: show,seat_numbers: "A1",status: "book")
c
        )c
          status: "book"
          seat_numbers: "A1",
          show: show,
          user: user,
Booking.create!(
          status: "book"
          seat_numbers: "A1",
          show: show,
          user: user,
Booking.create!(
booking
Booking
response
booking
c
cc
c
@movies
n
@movies
c
n
bookings_path
c
expect(response).to have_http_status(:ok)
c
n
response
bookings_path
c
show
movie
c
movie_show_path()
show_path()
show_path(movie show)
c
movie_show_path(movie show)
c
cc
movie_show_path(movie show)
movie_show_path( show)
movie_show_path(movie)
movie_show_path(movie show)
c
@show
c
show
movie
c
show
movie
c
show
c
show
c
show
movie
c
show
movie
c
@show
c
show_params
@show
c
@show
n
c
@show
n
@show
n
c
@show
@show.total_seats
n
@show
n
c
@show.total_seats
@show
n
@show
@show.total_seats
n
@show.total_seats
@show
n
c
@show
n
@show
c
movie_shows_path( movie )
c
movie_path(movie)
n
expect {post movie_shows_path( movie ), params: valid_show_params}
movie_shows_path( movie )
c
redirect_to(movie_path(movie))
redirect_to(movie_path(movie)
c
@show
n
@show
c
@movies
n
@movies
c
response
c
n
@movies
n
c
@movie
n
@movie
c
n
c
n
 cookies[:jwt]
n
c
cookies.signed[:jwt]
expect(response).to redirect_to(movies_path)
c
n
cookies.signed[:jwt] = { value: token, httponly: true }
n
token = encode_token({ user_id: user.id })
n
user&.authenticate(params[:password])
user
n
c
cc
c
response
response.http_status
c
response
c
user
n
user
c
user
n
user
c
user
n
user
c
user
n
c
user&.authenticate(params[:password])
if user&.authenticate(params[:password])
user&.authenticate(params[:password])
n
user
n
c
@show
n
@show
@user
n
@booking
n
c
self
c
reminder_time
c
n
c
user
c
user
c
User.all
User.al
c
user
c
user
c
user
c
